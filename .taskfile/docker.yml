version: "3"

tasks:
  up:
    desc: Start PostgreSQL container
    cmds:
      - docker compose up -d
      - echo "Waiting for PostgreSQL to be ready..."
      - |
        until docker compose exec -T postgres pg_isready -U ${POSTGRES_USER:-lazydb} -d ${POSTGRES_DB:-lazydb_dev} > /dev/null 2>&1; do
          sleep 1
        done
      - echo "PostgreSQL is ready!"

  down:
    desc: Stop PostgreSQL container
    cmds:
      - docker compose down

  logs:
    desc: Show PostgreSQL logs
    cmds:
      - docker compose logs -f postgres

  psql:
    desc: Connect to PostgreSQL with psql
    cmds:
      - docker compose exec postgres psql -U ${POSTGRES_USER:-lazydb} -d ${POSTGRES_DB:-lazydb_dev}

  reset:
    desc: Reset database (destroy and recreate with sample data)
    cmds:
      - docker compose down -v
      - task: up
